<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operational Risk Management Form - VQ-4 Shadows</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        body {
            background-color: #4b5563;
            color: #ffffff;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        .header-bg {
            background: linear-gradient(135deg, #1e3a8a, #4b5563);
            padding: 20px;
            text-align: center;
            position: relative;
            min-height: 150px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .logo {
            width: 100%;
            max-width: 800px;
            height: auto;
            object-fit: contain;
            border: 2px solid #93c5fd;
            padding: 5px;
            border-radius: 5px;
        }
        .content {
            max-width: 4xl;
            mx-auto;
            bg-gray-800;
            p-8;
            rounded-xl;
            shadow-2xl;
            mt-6;
            flex-grow: 1;
        }
        .input-field:focus {
            border-color: #93c5fd;
            box-shadow: 0 0 8px rgba(147, 197, 253, 0.6);
            transition: all 0.3s ease;
        }
        .status-message {
            display: none;
            margin-top: 1rem;
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            transition: opacity 0.3s ease;
        }
        .success { background-color: #d1fae5; color: #065f46; }
        .error { background-color: #fee2e2; color: #991b1b; }
        .risk-gauge {
            width: 200px;
            height: 20px;
            background: #4b5563;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
            transition: all 0.5s ease;
        }
        .gauge-fill {
            height: 100%;
            background: linear-gradient(90deg, #22c55e, #facc15, #ef4444);
            width: 0;
            transition: width 0.5s ease;
        }
        .footer {
            background-color: #2d3748;
            width: 100%;
            text-align: center;
            padding: 10px 0;
            margin-top: auto;
        }
        .footer p {
            margin: 0;
            font-size: 0.9rem;
        }
        .footer .contact-button {
            background-color: #1e3a8a;
            color: #ffffff;
            padding: 5px 15px;
            margin-top: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            text-decoration: none;
            display: inline-block;
        }
        .footer .contact-button:hover {
            background-color: #93c5fd;
        }
        /* Print-specific styles */
        @media print {
            body { background-color: #ffffff; color: #000000; }
            .content { box-shadow: none; max-width: 100%; padding: 0; }
            .header-bg, .footer, button, .status-message, .risk-assessment { display: none; }
            .input-field, textarea { border: 1px solid #000000; background-color: #ffffff; color: #000000; }
            h2 { font-size: 1.5rem; margin: 0.5rem 0; }
        }
        /* PDF-specific styles (temporarily visible for debug) */
        .pdf-content {
            display: none; /* Will be cloned, so keep hidden initially */
            background-color: #ffffff;
            color: #000000;
            font-family: Arial, sans-serif;
            padding: 20px;
            width: 100%;
            max-width: 800px;
        }
        .pdf-content h2 {
            font-size: 1.5rem;
            margin: 0.5rem 0;
            font-weight: bold;
        }
        .pdf-content p {
            margin: 0.25rem 0;
        }
    </style>
</head>
<body class="bg-gray-900 text-white font-sans" style="scroll-behavior: smooth;">
    <header class="header-bg">
        <img src="https://scontent-dfw5-1.xx.fbcdn.net/v/t39.30808-6/474584099_1021247700030529_7719994838169841359_n.jpg?_nc_cat=103&ccb=1-7&_nc_sid=cc71e4&_nc_ohc=EvyCodklsqIQ7kNvwG6Y3Pn&_nc_oc=AdmYohcjVAb99yYaLANFyoihsl50dwUppugeFpgRKJkB3ywLnCHJKROEfbxv39_a__Q&_nc_zt=23&_nc_ht=scontent-dfw5-1.xx&_nc_gid=bS3ZvUasMD0jaTJhAMH1MA&oh=00_AfPahKRnNzkVHkQlAonamRBYvLnm2el3r4oyJqkuxbO3xQ&oe=686B45FA" alt="VQ-4 Banner" class="logo">
    </header>
    <div class="content">
        <div class="bg-gray-700 p-6 rounded-lg mb-6 shadow-inner">
            <p class="text-lg font-medium text-gray-200 leading-relaxed">
                This questionnaire uses the Time Critical ABCD Model to focus the crew, increase situational awareness, and improve performance in the pre-flight and flight environments. Use this questionnaire to Assess the crew, Balance resources, Communicate and then mitigate any assessed risk or decisions, Do the mission with the mitigations in place, and De-brief the mission once completed.<br><br>
                <strong class="text-yellow-300">NOTE:</strong> The use of this questionnaire does not alleviate the requirement to perform deliberate ORM as called out in other instructions and SOPs.
            </p>
        </div>

        <!-- Flight Information -->
        <h2 class="text-2xl font-semibold text-gray-100 mb-4">Flight Information</h2>
        <div class="space-y-6 mb-6">
            <div>
                <label class="block text-lg font-medium text-gray-200" for="acmc">AC/MC <span class="text-red-400">*</span></label>
                <input type="text" id="acmc" class="w-full p-3 border rounded-lg input-field bg-gray-600 text-white border-gray-500" required>
                <span id="acmcError" class="text-red-400 hidden">AC/MC is required.</span>
            </div>
            <div>
                <label class="block text-lg font-medium text-gray-200" for="additionalCrew">Any Additional Crew Members/Passengers</label>
                <input type="text" id="additionalCrew" class="w-full p-3 border rounded-lg input-field bg-gray-600 text-white border-gray-500">
            </div>
            <div>
                <label class="block text-lg font-medium text-gray-200" for="crew">Crew <span class="text-red-400">*</span></label>
                <select id="crew" class="w-full p-3 border rounded-lg input-field bg-gray-600 text-white border-gray-500" required>
                    <option value="">Choose</option>
                    <option value="LC1">LC1</option>
                    <option value="LC2">LC2</option>
                    <option value="LC3">LC3</option>
                    <option value="LC4">LC4</option>
                    <option value="LC5">LC5</option>
                    <option value="LC6">LC6</option>
                    <option value="LC7">LC7</option>
                    <option value="LC8">LC8</option>
                    <option value="Local">Local</option>
                </select>
                <span id="crewError" class="text-red-400 hidden">Crew is required.</span>
            </div>
            <div>
                <label class="block text-lg font-medium text-gray-200" for="takeoffTime">Scheduled Takeoff Time - Zulu <span class="text-red-400">*</span></label>
                <input type="text" id="takeoffTime" class="w-full p-3 border rounded-lg input-field bg-gray-600 text-white border-gray-500" required>
                <span id="takeoffError" class="text-red-400 hidden">Takeoff Time is required.</span>
            </div>
        </div>

        <!-- Human Factors -->
        <h2 class="text-2xl font-semibold text-gray-100 mb-4">Human Factors</h2>
        <div class="space-y-2 mb-4">
            <label><input type="checkbox" class="mr-2" data-severity="2" id="q1"> 1. Cumulative fatigue from ≥4 duty days (≥12 hrs/day) in past 5 days</label><br>
            <label><input type="checkbox" class="mr-2" data-severity="3" id="q2"> 2. Cumulative sleep debt (2+ nights w/ <6 hrs sleep in past 72 hrs WHILE being allotted required crew rest time)</label><br>
            <label><input type="checkbox" class="mr-2" data-severity="2" id="q3"> 3. Circadian rhythm disruption (day ↔ night shift in past 48 hrs)</label><br>
            <label><input type="checkbox" class="mr-2" data-severity="1" id="q4"> 4. Recent personal stressors</label><br>
            <label><input type="checkbox" class="mr-2" data-severity="1" id="q5"> 5. First mission after ≥30-day non-flying period</label><br>
            <label><input type="checkbox" class="mr-2" data-severity="2" id="q6"> 6. Any Crew Member not current</label><br>
        </div>
        <div class="mb-6">
            <label class="block text-lg font-medium text-gray-200" for="humanMitigations">Mitigations for Selected Human Factors Risks</label>
            <textarea id="humanMitigations" class="w-full p-3 border rounded-lg input-field bg-gray-600 text-white border-gray-500" rows="3" placeholder="Briefly describe mitigations..."></textarea>
        </div>

        <!-- Scheduling & Tempo Factors -->
        <h2 class="text-2xl font-semibold text-gray-100 mb-4">Scheduling & Tempo Factors</h2>
        <div class="space-y-2 mb-4">
            <label><input type="checkbox" class="mr-2" data-severity="2" id="q7"> 7. Crew rest <12 hours</label><br>
            <label><input type="checkbox" class="mr-2" data-severity="2" id="q8"> 8. Long sortie (>12 hour planned crew day)</label><br>
            <label><input type="checkbox" class="mr-2" data-severity="2" id="q9"> 9. Planned crew day includes duty between the hours of 2200-0600</label><br>
            <label><input type="checkbox" class="mr-2" data-severity="3" id="q10"> 10. Projected duty day ≥15 hrs (approaching 18-hour max)</label><br>
            <label><input type="checkbox" class="mr-2" data-severity="2" id="q11"> 11. Crew scheduled to cross ≥2 time zones in 48-hr period, increasing risk of circadian disruption and fatigue</label><br>
            <label><input type="checkbox" class="mr-2" data-severity="2" id="q12"> 12. Significant mission change after crew report time requiring re-brief or operational adjustment</label><br>
            <label><input type="checkbox" class="mr-2" data-severity="2" id="q13"> 13. Crew scheduled without adequate recovery following night mission</label><br>
        </div>
        <div class="mb-6">
            <label class="block text-lg font-medium text-gray-200" for="schedulingMitigations">Mitigations for Selected Scheduling & Tempo Factors Risks</label>
            <textarea id="schedulingMitigations" class="w-full p-3 border rounded-lg input-field bg-gray-600 text-white border-gray-500" rows="3" placeholder="Briefly describe mitigations..."></textarea>
        </div>

        <!-- Mission Factors -->
        <h2 class="text-2xl font-semibold text-gray-100 mb-4">Mission Factors</h2>
        <div class="space-y-2 mb-4">
            <label><input type="checkbox" class="mr-2" data-severity="1" id="q14"> 14. Op Area evolution</label><br>
            <label><input type="checkbox" class="mr-2" data-severity="2" id="q15"> 15. Air Refueling</label><br>
            <label><input type="checkbox" class="mr-2" data-severity="3" id="q16"> 16. Pilot Training Event (engine pulls)</label><br>
            <label><input type="checkbox" class="mr-2" data-severity="2" id="q17"> 17. Closed Tower / Uncontrolled Field Ops</label><br>
            <label><input type="checkbox" class="mr-2" data-severity="2" id="q18"> 18. R4305 Op Area</label><br>
            <label><input type="checkbox" class="mr-2" data-severity="2" id="q19"> 19. Unfamiliar Airfield Ops</label><br>
            <label><input type="checkbox" class="mr-2" data-severity="1" id="q20"> 20. Delayed Takeoff (mx, weather, etc...)</label><br>
            <label><input type="checkbox" class="mr-2" data-severity="2" id="q21"> 21. Known degraded system(s) requiring crew workaround (e.g., comm, nav, radar, ICS)</label><br>
            <label><input type="checkbox" class="mr-2" data-severity="3" id="q22"> 22. Crew augmentation not available despite extended/multi-segment profile</label><br>
        </div>
        <div class="mb-6">
            <label class="block text-lg font-medium text-gray-200" for="missionMitigations">Mitigations for Selected Mission Factors Risks</label>
            <textarea id="missionMitigations" class="w-full p-3 border rounded-lg input-field bg-gray-600 text-white border-gray-500" rows="3" placeholder="Briefly describe mitigations..."></textarea>
        </div>

        <!-- Environmental Factors -->
        <h2 class="text-2xl font-semibold text-gray-100 mb-4">Environmental Factors</h2>
        <div class="space-y-2 mb-4">
            <label><input type="checkbox" class="mr-2" data-severity="2" id="q23"> 23. Flying at night</label><br>
            <label><input type="checkbox" class="mr-2" data-severity="2" id="q24"> 24. Departure weather <1500 ft ceiling and/or <3 sm visibility</label><br>
            <label><input type="checkbox" class="mr-2" data-severity="3" id="q25"> 25. Enroute weather concerns (thunderstorms, icing, turbulence)</label><br>
            <label><input type="checkbox" class="mr-2" data-severity="2" id="q26"> 26. Destination weather <1500 ft ceiling and/or <3 sm visibility</label><br>
            <label><input type="checkbox" class="mr-2" data-severity="2" id="q27"> 27. Elevated bird/wildlife activity at departure/destination field</label><br>
        </div>
        <div class="mb-6">
            <label class="block text-lg font-medium text-gray-200" for="environmentalMitigations">Mitigations for Selected Environmental Factors Risks</label>
            <textarea id="environmentalMitigations" class="w-full p-3 border rounded-lg input-field bg-gray-600 text-white border-gray-500" rows="3" placeholder="Briefly describe mitigations..."></textarea>
        </div>

        <!-- AC/MC Review Question -->
        <div class="mb-6">
            <label class="block text-lg font-medium text-gray-200">Has the AC/MC reviewed all risk factors and mitigations? <span class="text-red-400">*</span></label>
            <div class="flex items-center space-x-4">
                <label><input type="radio" name="acmcReview" id="acmcReviewYes" value="yes" class="mr-2"> Yes</label>
                <label><input type="radio" name="acmcReview" id="acmcReviewNo" value="no" class="mr-2"> No</label>
            </div>
            <span id="acmcReviewError" class="text-red-400 hidden">AC/MC review (Yes) is required to submit.</span>
        </div>

        <div class="flex space-x-4 mb-6">
            <button id="submitData" class="submit-btn bg-blue-600 text-white p-3 rounded-lg">Submit</button>
            <button id="generatePdf" class="pdf-btn bg-green-600 text-white p-3 rounded-lg">Generate PDF</button>
        </div>
        <div id="statusMessage" class="status-message"></div>
        <div id="riskAssessment" class="mt-6 p-4 bg-gray-700 rounded-lg hidden">
            <h2 class="text-lg font-semibold text-gray-100">Risk Assessment</h2>
            <div class="risk-gauge">
                <div id="gaugeFill" class="gauge-fill"></div>
            </div>
            <p class="mt-2"><strong>Total Risk Score:</strong> <span id="totalScore" class="text-gray-100 font-medium">0</span></p>
            <p><strong>Risk Rank:</strong> <span id="riskRank" class="text-gray-100 font-medium">None</span></p>
            <p id="riskNote" class="mt-2 text-red-400"></p>
        </div>
    </div>
    <div class="footer">
        <p>Any issues or recommendations can be directed to LT Brian Byrd</p>
        <a href="mailto:brian.a.byrd7.mil@us.navy.mil" class="contact-button">Contact LT Byrd</a>
    </div>

    <div id="pdf-content" class="pdf-content">
        <h2>Flight Information</h2>
        <p id="pdf-acmc"></p>
        <p id="pdf-crew"></p>
        <p id="pdf-takeoffTime"></p>
        <p id="pdf-submissionDate"></p>

        <h2>Human Factors</h2>
        <p id="pdf-q1"></p>
        <p id="pdf-q2"></p>
        <p id="pdf-q3"></p>
        <p id="pdf-q4"></p>
        <p id="pdf-q5"></p>
        <p id="pdf-q6"></p>
        <p id="pdf-humanMitigations"></p>

        <h2>Scheduling & Tempo Factors</h2>
        <p id="pdf-q7"></p>
        <p id="pdf-q8"></p>
        <p id="pdf-q9"></p>
        <p id="pdf-q10"></p>
        <p id="pdf-q11"></p>
        <p id="pdf-q12"></p>
        <p id="pdf-q13"></p>
        <p id="pdf-schedulingMitigations"></p>

        <h2>Mission Factors</h2>
        <p id="pdf-q14"></p>
        <p id="pdf-q15"></p>
        <p id="pdf-q16"></p>
        <p id="pdf-q17"></p>
        <p id="pdf-q18"></p>
        <p id="pdf-q19"></p>
        <p id="pdf-q20"></p>
        <p id="pdf-q21"></p>
        <p id="pdf-q22"></p>
        <p id="pdf-missionMitigations"></p>

        <h2>Environmental Factors</h2>
        <p id="pdf-q23"></p>
        <p id="pdf-q24"></p>
        <p id="pdf-q25"></p>
        <p id="pdf-q26"></p>
        <p id="pdf-q27"></p>
        <p id="pdf-environmentalMitigations"></p>

        <h2>AC/MC Review</h2>
        <p id="pdf-acmcReview"></p>

        <h2>Risk Assessment</h2>
        <p id="pdf-totalScore"></p>
        <p id="pdf-riskRank"></p>
        <p id="pdf-riskNote"></p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM fully loaded and script running');
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            const totalScoreElement = document.getElementById('totalScore');
            const riskRankElement = document.getElementById('riskRank');
            const riskNoteElement = document.getElementById('riskNote');
            const gaugeFill = document.getElementById('gaugeFill');
            const submitButton = document.getElementById('submitData');
            const generatePdfButton = document.getElementById('generatePdf');
            const pdfContent = document.getElementById('pdf-content');

            if (!submitButton || !generatePdfButton || !pdfContent) {
                console.error('Required elements not found:', { submitButton, generatePdfButton, pdfContent });
                return;
            }

            submitButton.addEventListener('click', () => {
                console.log('Submit button clicked');
                const acmc = document.getElementById('acmc').value.trim();
                const crew = document.getElementById('crew').value;
                const takeoffTime = document.getElementById('takeoffTime').value.trim();
                const acmcReviewYes = document.getElementById('acmcReviewYes').checked;
                let isValid = true;

                if (!acmc) {
                    document.getElementById('acmcError').classList.remove('hidden');
                    isValid = false;
                } else {
                    document.getElementById('acmcError').classList.add('hidden');
                }
                if (!crew) {
                    document.getElementById('crewError').classList.remove('hidden');
                    isValid = false;
                } else {
                    document.getElementById('crewError').classList.add('hidden');
                }
                if (!takeoffTime) {
                    document.getElementById('takeoffError').classList.remove('hidden');
                    isValid = false;
                } else {
                    document.getElementById('takeoffError').classList.add('hidden');
                }
                if (!acmcReviewYes) {
                    document.getElementById('acmcReviewError').classList.remove('hidden');
                    isValid = false;
                } else {
                    document.getElementById('acmcReviewError').classList.add('hidden');
                }

                if (!isValid) {
                    document.getElementById('statusMessage').classList.remove('success', 'hidden');
                    document.getElementById('statusMessage').classList.add('error');
                    document.getElementById('statusMessage').textContent = 'Please fill in all required fields and confirm AC/MC review.';
                    return;
                }

                let total = 0;
                checkboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        total += parseInt(checkbox.getAttribute('data-severity') || 0);
                    }
                });
                let riskRank = '';
                let riskNote = '';
                if (total >= 21) {
                    riskRank = 'High';
                    riskNote = 'Call OPS Ofor approval or change mission to bring risk down.';
                } else if (total >= 11) {
                    riskRank = 'Moderate';
                    riskNote = 'Call the CDO to brief mitigation.';
                } else {
                    riskRank = 'Low';
                    riskNote = 'No action required.';
                }

                const maxScore = 81;
                const scorePercentage = (total / maxScore) * 100;
                gaugeFill.style.width = `${scorePercentage}%`;

                const formData = {
                    acmc: acmc,
                    additionalCrew: document.getElementById('additionalCrew').value || '',
                    crew: crew,
                    takeoffTime: takeoffTime,
                    humanFactors: Array.from(checkboxes)
                        .filter(cb => cb.id >= 'q1' && cb.id <= 'q6' && cb.checked)
                        .map(cb => cb.nextSibling.textContent.trim()).join(', ') || 'None',
                    humanMitigations: document.getElementById('humanMitigations').value.trim() || 'N/A',
                    schedulingFactors: Array.from(checkboxes)
                        .filter(cb => cb.id >= 'q7' && cb.id <= 'q13' && cb.checked)
                        .map(cb => cb.nextSibling.textContent.trim()).join(', ') || 'None',
                    schedulingMitigations: document.getElementById('schedulingMitigations').value.trim() || 'N/A',
                    missionFactors: Array.from(checkboxes)
                        .filter(cb => cb.id >= 'q14' && cb.id <= 'q22' && cb.checked)
                        .map(cb => cb.nextSibling.textContent.trim()).join(', ') || 'None',
                    missionMitigations: document.getElementById('missionMitigations').value.trim() || 'N/A',
                    environmentalFactors: Array.from(checkboxes)
                        .filter(cb => cb.id >= 'q23' && cb.id <= 'q27' && cb.checked)
                        .map(cb => cb.nextSibling.textContent.trim()).join(', ') || 'None',
                    environmentalMitigations: document.getElementById('environmentalMitigations').value.trim() || 'N/A',
                    totalScore: total,
                    riskRank: riskRank,
                    riskNote: riskNote,
                    acmcReview: acmcReviewYes ? 'Yes' : 'No',
                    submissionDate: new Date().toLocaleString()
                };

                document.getElementById('statusMessage').classList.remove('error', 'hidden');
                document.getElementById('statusMessage').classList.add('success');
                document.getElementById('statusMessage').textContent = 'Submitting data via Formspree...';

                fetch('https://formspree.io/f/xnnvlwap', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: Object.entries(formData).map(([key, value]) => `${encodeURIComponent(key)}=${encodeURIComponent(value)}`).join('&'),
                    redirect: 'manual'
                })
                .then(response => {
                    if (response.type === 'opaqueredirect' || response.status === 200) {
                        return { ok: true, text: 'Success' };
                    }
                    if (!response.ok) throw new Error('Network response was not ok: ' + response.status);
                    return response.text();
                })
                .then(result => {
                    if (result.ok || (typeof result === 'string' && result.toLowerCase().includes('success'))) {
                        document.getElementById('statusMessage').textContent = 'Data submitted successfully!';
                        totalScoreElement.textContent = total;
                        riskRankElement.textContent = riskRank;
                        riskNoteElement.textContent = riskNote;
                        riskAssessment.classList.remove('hidden');
                    } else {
                        throw new Error('Unexpected response: ' + result);
                    }
                })
                .catch(error => {
                    console.error('Fetch error:', error);
                    document.getElementById('statusMessage').classList.remove('success', 'hidden');
                    document.getElementById('statusMessage').classList.add('error');
                    document.getElementById('statusMessage').textContent = 'Error submitting data: ' + error.message;
                });
            });

            generatePdfButton.addEventListener('click', () => {
                console.log('Generate PDF button clicked');
                const acmc = document.getElementById('acmc').value.trim();
                const crew = document.getElementById('crew').value;
                const takeoffTime = document.getElementById('takeoffTime').value.trim();
                const acmcReviewYes = document.getElementById('acmcReviewYes').checked;
                let isValid = true;

                if (!acmc || !crew || !takeoffTime || !acmcReviewYes) {
                    document.getElementById('statusMessage').classList.remove('success', 'hidden');
                    document.getElementById('statusMessage').classList.add('error');
                    document.getElementById('statusMessage').textContent = 'Please fill in all required fields and confirm AC/MC review to generate PDF.';
                    return;
                }

                let total = 0;
                checkboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        total += parseInt(checkbox.getAttribute('data-severity') || 0);
                    }
                });
                let riskRank = '';
                let riskNote = '';
                if (total >= 21) {
                    riskRank = 'High';
                    riskNote = 'Call OPS Ofor approval or change mission to bring risk down.';
                } else if (total >= 11) {
                    riskRank = 'Moderate';
                    riskNote = 'Call the CDO to brief mitigation.';
                } else {
                    riskRank = 'Low';
                    riskNote = 'No action required.';
                }

                // Populate PDF content
                console.log('Populating PDF content...');
                document.getElementById('pdf-acmc').textContent = `AC/MC: ${acmc}`;
                console.log(`Set pdf-acmc: ${acmc}`);
                document.getElementById('pdf-crew').textContent = `Crew: ${crew}`;
                document.getElementById('pdf-takeoffTime').textContent = `Takeoff Time: ${takeoffTime}`;
                document.getElementById('pdf-submissionDate').textContent = `Submission Date: ${new Date().toLocaleString()}`;
                document.getElementById('pdf-humanMitigations').textContent = `Mitigations: ${document.getElementById('humanMitigations').value.trim() || 'N/A'}`;
                document.getElementById('pdf-schedulingMitigations').textContent = `Mitigations: ${document.getElementById('schedulingMitigations').value.trim() || 'N/A'}`;
                document.getElementById('pdf-missionMitigations').textContent = `Mitigations: ${document.getElementById('missionMitigations').value.trim() || 'N/A'}`;
                document.getElementById('pdf-environmentalMitigations').textContent = `Mitigations: ${document.getElementById('environmentalMitigations').value.trim() || 'N/A'}`;
                document.getElementById('pdf-acmcReview').textContent = `AC/MC Review: ${acmcReviewYes ? 'Yes' : 'No'}`;
                document.getElementById('pdf-totalScore').textContent = `Total Risk Score: ${total}`;
                document.getElementById('pdf-riskRank').textContent = `Risk Rank: ${riskRank}`;
                document.getElementById('pdf-riskNote').textContent = `Note: ${riskNote}`;

                const factors = [
                    { id: 'q1', text: 'Cumulative fatigue from ≥4 duty days (≥12 hrs/day) in past 5 days' },
                    { id: 'q2', text: 'Cumulative sleep debt (2+ nights w/ <6 hrs sleep in past 72 hrs)' },
                    { id: 'q3', text: 'Circadian rhythm disruption (day ↔ night shift in past 48 hrs)' },
                    { id: 'q4', text: 'Recent personal stressors' },
                    { id: 'q5', text: 'First mission after ≥30-day non-flying period' },
                    { id: 'q6', text: 'Any Crew Member not current' },
                    { id: 'q7', text: 'Crew rest <12 hours' },
                    { id: 'q8', text: 'Long sortie (>12 hour planned crew day)' },
                    { id: 'q9', text: 'Planned crew day includes duty between 2200-0600' },
                    { id: 'q10', text: 'Projected duty day ≥15 hrs (approaching 18-hour max)' },
                    { id: 'q11', text: 'Crew scheduled to cross ≥2 time zones in 48-hr period' },
                    { id: 'q12', text: 'Significant mission change after crew report time' },
                    { id: 'q13', text: 'Crew scheduled without adequate recovery following night mission' },
                    { id: 'q14', text: 'Op Area evolution' },
                    { id: 'q15', text: 'Air Refueling' },
                    { id: 'q16', text: 'Pilot Training Event (engine pulls)' },
                    { id: 'q17', text: 'Closed Tower / Uncontrolled Field Ops' },
                    { id: 'q18', text: 'R4305 Op Area' },
                    { id: 'q19', text: 'Unfamiliar Airfield Ops' },
                    { id: 'q20', text: 'Delayed Takeoff (mx, weather, etc...)' },
                    { id: 'q21', text: 'Known degraded system(s) requiring crew workaround' },
                    { id: 'q22', text: 'Crew augmentation not available' },
                    { id: 'q23', text: 'Flying at night' },
                    { id: 'q24', text: 'Departure weather <1500 ft ceiling and/or <3 sm visibility' },
                    { id: 'q25', text: 'Enroute weather concerns (thunderstorms, icing, turbulence)' },
                    { id: 'q26', text: 'Destination weather <1500 ft ceiling and/or <3 sm visibility' },
                    { id: 'q27', text: 'Elevated bird/wildlife activity at departure/destination field' }
                ];

                factors.forEach(factor => {
                    const checkbox = document.getElementById(factor.id);
                    const element = document.getElementById(`pdf-${factor.id}`);
                    if (element) {
                        element.textContent = `${checkbox.checked ? '[x]' : '[ ]'} ${factor.text}`;
                        console.log(`Populated ${factor.id}: ${element.textContent}`);
                    }
                });

                // Debug: Temporarily make visible to check content
                pdfContent.style.display = 'block';
                console.log('PDF content visibility set to block for debug, content:', pdfContent.innerHTML);

                // Generate PDF
                html2pdf().from(pdfContent).save('ORM_Form_Submission.pdf').then(() => {
                    console.log('PDF generation completed');
                    // Hide again after generation
                    pdfContent.style.display = 'none';
                }).catch(error => {
                    console.error('PDF generation error:', error);
                });
            });
        });
    </script>
</body>
</html>